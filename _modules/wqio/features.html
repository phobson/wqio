

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>wqio.features &mdash; wqio 0.4.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="wqio 0.4.0 documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> wqio
          

          
          </a>

          
            
            
              <div class="version">
                0.4.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../include_readme.html">wqio - Water Quality, Inflow/Outflow</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">Statisical APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html#water-quality-and-hydrology-apis">Water Quality and Hydrology APIs</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">wqio</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>wqio.features</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for wqio.features</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.ticker</span> <span class="kn">as</span> <span class="nn">mticker</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="kn">as</span> <span class="nn">sm</span>
<span class="kn">from</span> <span class="nn">statsmodels.tools.decorators</span> <span class="kn">import</span> <span class="n">resettable_cache</span><span class="p">,</span> <span class="n">cache_readonly</span>
<span class="kn">import</span> <span class="nn">seaborn.apionly</span> <span class="kn">as</span> <span class="nn">seaborn</span>

<span class="kn">from</span> <span class="nn">wqio</span> <span class="kn">import</span> <span class="n">utils</span>
<span class="kn">from</span> <span class="nn">wqio</span> <span class="kn">import</span> <span class="n">bootstrap</span>
<span class="kn">from</span> <span class="nn">wqio.ros</span> <span class="kn">import</span> <span class="n">ROS</span>


<span class="c1"># meta data mappings based on station</span>
<span class="n">station_names</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;inflow&#39;</span><span class="p">:</span> <span class="s1">&#39;Influent&#39;</span><span class="p">,</span>
    <span class="s1">&#39;outflow&#39;</span><span class="p">:</span> <span class="s1">&#39;Effluent&#39;</span><span class="p">,</span>
    <span class="s1">&#39;reference&#39;</span><span class="p">:</span> <span class="s1">&#39;Reference Flow&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">markers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Influent&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">],</span>
    <span class="s1">&#39;Effluent&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">],</span>
    <span class="s1">&#39;Reference Flow&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">],</span>
<span class="p">}</span>

<span class="n">palette</span> <span class="o">=</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="n">palette</span><span class="o">=</span><span class="s1">&#39;deep&#39;</span><span class="p">,</span> <span class="n">n_colors</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">desat</span><span class="o">=</span><span class="mf">0.88</span><span class="p">)</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Influent&#39;</span><span class="p">:</span> <span class="n">palette</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="s1">&#39;Effluent&#39;</span><span class="p">:</span> <span class="n">palette</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="s1">&#39;Reference Flow&#39;</span><span class="p">:</span> <span class="n">palette</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
<span class="p">}</span>


<div class="viewcode-block" id="Parameter"><a class="viewcode-back" href="../../api/features.html#wqio.features.Parameter">[docs]</a><span class="k">class</span> <span class="nc">Parameter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">usingTex</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Class representing a single analytical parameter (pollutant).</span>

<span class="sd">        (Input) Parameters</span>
<span class="sd">        ------------------</span>
<span class="sd">        name : string</span>
<span class="sd">            Name of the parameter.</span>
<span class="sd">        units : string</span>
<span class="sd">            Units of measure for the parameter.</span>
<span class="sd">        usingTex : bool, optional (default = False)</span>
<span class="sd">            If True, all returned values will be optimized for inclusion</span>
<span class="sd">            in LaTeX documents.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_units</span> <span class="o">=</span> <span class="n">units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_usingTex</span> <span class="o">=</span> <span class="n">usingTex</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>
    <span class="nd">@name.setter</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">units</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span>
    <span class="nd">@units.setter</span>
    <span class="k">def</span> <span class="nf">units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_units</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">usingTex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_usingTex</span>
    <span class="nd">@usingTex.setter</span>
    <span class="k">def</span> <span class="nf">usingTex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_usingTex</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`usingTex` must be of type `bool`&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Parameter.paramunit"><a class="viewcode-back" href="../../api/features.html#wqio.features.Parameter.paramunit">[docs]</a>    <span class="k">def</span> <span class="nf">paramunit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">usecomma</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates a string representation of the parameter and units.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        usecomma : bool, optional (default = False)</span>
<span class="sd">            Toggles the format of the returned string attribute. If True</span>
<span class="sd">            the returned format is &quot;&lt;parameter&gt;, &lt;unit&gt;&quot;. Otherwise the</span>
<span class="sd">            format is &quot;&lt;parameter&gt; (&lt;unit&gt;)&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">usecomma</span><span class="p">:</span>
            <span class="n">paramunit</span> <span class="o">=</span> <span class="s1">&#39;{0}, {1}&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">paramunit</span> <span class="o">=</span> <span class="s1">&#39;{0} ({1})&#39;</span>

        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span>

        <span class="k">return</span> <span class="n">paramunit</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;wqio Parameter object&gt; ({})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">paramunit</span><span class="p">(</span><span class="n">usecomma</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;wqio Parameter object&gt; ({})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">paramunit</span><span class="p">(</span><span class="n">usecomma</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Location"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location">[docs]</a><span class="k">class</span> <span class="nc">Location</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Object providing convenient access to statistical and</span>
<span class="sd">    graphical methods for summarizing a single set of water quality</span>
<span class="sd">    observations for a single pollutant.</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    dataframe : pandas.DataFrame</span>
<span class="sd">        A dataframe that contains at least two columns: one for the</span>
<span class="sd">        analytical values and another for the data qualfiers. Can</span>
<span class="sd">        contain any type of row index, but the column index must be</span>
<span class="sd">        simple (i.e., not a pandas.MultiIndex).</span>
<span class="sd">    rescol : string, optional (default = &#39;res&#39;)</span>
<span class="sd">        Name of the column in `dataframe` that contains the</span>
<span class="sd">        analytical values.</span>
<span class="sd">    qualcol : string, optional (default = &#39;qual&#39;)</span>
<span class="sd">        Name of the column in `dataframe` containing qualifiers.</span>
<span class="sd">    ndval : string, optional (default = &#39;ND&#39;)</span>
<span class="sd">        The *only* value in the `qualcol` of `dataframe` that</span>
<span class="sd">        indicates that the corresponding value in `rescol` is</span>
<span class="sd">        non-detect.</span>
<span class="sd">    station_type : string, optional</span>
<span class="sd">        Type of location being analyzed. Valid values are:</span>
<span class="sd">        &#39;inflow&#39; (default) or &#39;outflow&#39;.</span>
<span class="sd">    useROS : bool, optional (default = True)</span>
<span class="sd">        Toggles the use of Regression On Order Statistics to</span>
<span class="sd">        estimate non-detect values when computing statistics.</span>
<span class="sd">    cencol : string, optional (default = &#39;cen&#39;)</span>
<span class="sd">        Name of the column indicaticating if a results is censored.</span>
<span class="sd">        These values will be computed from ``qualcol`` and ``ndval``.</span>
<span class="sd">    bsIter : int, optional (default = 1e4)</span>
<span class="sd">        Number of interations to use when using a bootstrap</span>
<span class="sd">        algorithm to refine a statistic.</span>
<span class="sd">    include : bool, optional (default = True)</span>
<span class="sd">        Toggles the inclusion of the location when programmatically</span>
<span class="sd">        creating many `Location` objects.</span>

<span class="sd">    Settable Properties</span>
<span class="sd">    -------------------</span>
<span class="sd">    .name : string</span>
<span class="sd">        A human-readable name for the data.</span>
<span class="sd">    .definition : dict</span>
<span class="sd">        A dictionary of key-value pairs that define what makes this</span>
<span class="sd">        data distinct within a larger collection of `Location` objects.</span>
<span class="sd">    .include : bool</span>
<span class="sd">        Same as input.</span>

<span class="sd">    Statistical Attributes</span>
<span class="sd">    ----------------------</span>
<span class="sd">    .N : int</span>
<span class="sd">        Total number of results.</span>
<span class="sd">    .ND : int</span>
<span class="sd">        Number of non-detect results.</span>
<span class="sd">    .NUnique : int</span>
<span class="sd">        Number of unique result values in the data.</span>
<span class="sd">    .fractionND : float</span>
<span class="sd">        Fraction of data that is non-detect.</span>
<span class="sd">    .min : float</span>
<span class="sd">        Minimum value of the data.</span>
<span class="sd">    .max : float</span>
<span class="sd">        Maximum value of the data.</span>
<span class="sd">    .min_detect : float</span>
<span class="sd">        Minimum detected value of the data.</span>
<span class="sd">    .min_DL : float</span>
<span class="sd">        Minimum detection limit reported for the data.</span>
<span class="sd">    .mean*+^ : float</span>
<span class="sd">        Bootstrapped arithmetic mean of the data.</span>
<span class="sd">    .std*+^ : float</span>
<span class="sd">        Bootstrapped standard deviation of the data.</span>
<span class="sd">    .cov : float</span>
<span class="sd">        Covariance (absolute value of std/mean).</span>
<span class="sd">    .skew : float</span>
<span class="sd">        Skewness coefficient.</span>
<span class="sd">    .median* : float</span>
<span class="sd">        Median of the dataset.</span>
<span class="sd">    .pctl[10/25/75/90] : float</span>
<span class="sd">        Percentiles of the dataset.</span>
<span class="sd">    .pnorm : float</span>
<span class="sd">        Results of the Shapiro-Wilks test for normality.</span>
<span class="sd">    .plognorm : float</span>
<span class="sd">        Results of the Shapiro-Wilks test for normality on</span>
<span class="sd">        log-transormed data (so really a test for lognormalily).</span>
<span class="sd">    .lillifors+ : list of floats</span>
<span class="sd">        Lillifors statistic and p-value.</span>
<span class="sd">    .shapiro+ : list of floats</span>
<span class="sd">        Shapiro-Wilks statistic and p-value.</span>
<span class="sd">    .anderson+ : tuple</span>
<span class="sd">        Anderson-Darling statistic, critical values, significance</span>
<span class="sd">        levels.</span>
<span class="sd">    .analysis_space : string</span>
<span class="sd">        Based on the results of self.pnorm and self.plognorm, this is</span>
<span class="sd">        either &quot;normal&quot; or &quot;lognormal&quot;.</span>

<span class="sd">    Statistial Notes</span>
<span class="sd">    ----------------</span>
<span class="sd">    * Indicates that there&#39;s an accompyaning tuple of confidence</span>
<span class="sd">      interval. For example, self.mean and self.mean_conf_interval</span>
<span class="sd">    + Indicatates that there&#39;s a equivalent stat for log-transormed</span>
<span class="sd">      data. For example, self.mean and self.logmean or self.lilliefors</span>
<span class="sd">      and self.lilliefors_log (subject to the absense of negitive</span>
<span class="sd">      results).</span>
<span class="sd">    ^ Indicatates that there&#39;s a equivalent stat in geometric space.</span>
<span class="sd">      For example, self.mean and self.geomean.</span>

<span class="sd">    Plotting Methods</span>
<span class="sd">    ----------------</span>
<span class="sd">    .verticalScatter</span>
<span class="sd">    .boxplot</span>
<span class="sd">    .probplot</span>
<span class="sd">    .statplot</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataframe</span><span class="p">,</span> <span class="n">rescol</span><span class="o">=</span><span class="s1">&#39;res&#39;</span><span class="p">,</span> <span class="n">qualcol</span><span class="o">=</span><span class="s1">&#39;qual&#39;</span><span class="p">,</span> <span class="n">ndval</span><span class="o">=</span><span class="s1">&#39;ND&#39;</span><span class="p">,</span>
                 <span class="n">station_type</span><span class="o">=</span><span class="s1">&#39;inflow&#39;</span><span class="p">,</span> <span class="n">useROS</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">cencol</span><span class="o">=</span><span class="s1">&#39;cen&#39;</span><span class="p">,</span>
                 <span class="n">bsIter</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="c1"># plotting symbology based on location type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_type</span> <span class="o">=</span> <span class="n">station_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station_name</span> <span class="o">=</span> <span class="n">station_names</span><span class="p">[</span><span class="n">station_type</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_marker</span> <span class="o">=</span> <span class="n">markers</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">station_name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scatter_marker</span> <span class="o">=</span> <span class="n">markers</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">station_name</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">station_name</span><span class="p">]</span>

        <span class="c1"># basic stuff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">station_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_include</span> <span class="o">=</span> <span class="n">include</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_definition</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># parameters of the stats analysis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span> <span class="o">=</span> <span class="n">resettable_cache</span><span class="p">()</span>

        <span class="c1"># properties of the dataframe and analysis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsIter</span> <span class="o">=</span> <span class="n">bsIter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">useROS</span> <span class="o">=</span> <span class="n">useROS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rescol</span> <span class="o">=</span> <span class="n">rescol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qualcol</span> <span class="o">=</span> <span class="n">qualcol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cencol</span> <span class="o">=</span> <span class="n">cencol</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">ndval</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ndvals</span> <span class="o">=</span> <span class="p">[</span><span class="n">ndval</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ndvals</span> <span class="o">=</span> <span class="n">ndval</span>

        <span class="c1"># original data and quantity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
            <span class="o">**</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cencol</span><span class="p">:</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">qualcol</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndvals</span><span class="p">)}</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cencol</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">qualcol</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndvals</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">useROS</span><span class="p">:</span>
                    <span class="n">ros</span> <span class="o">=</span> <span class="n">ROS</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rescol</span><span class="p">,</span> <span class="n">censorship</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cencol</span><span class="p">,</span> <span class="n">as_array</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span> <span class="o">=</span> <span class="n">ros</span><span class="p">[[</span><span class="s1">&#39;final&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cencol</span><span class="p">]]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">rescol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cencol</span><span class="p">]]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataframe</span>

    <span class="nd">@property</span>
    <span class="nd">@np.deprecate</span>
    <span class="k">def</span> <span class="nf">full_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">useROS</span><span class="p">:</span>
               <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;final&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rescol</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="k">return</span> <span class="n">output</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>
    <span class="nd">@name.setter</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">definition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_definition</span>
    <span class="nd">@definition.setter</span>
    <span class="k">def</span> <span class="nf">definition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_definition</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">include</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_include</span>
    <span class="nd">@include.setter</span>
    <span class="k">def</span> <span class="nf">include</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_include</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">exclude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">include</span>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Location.N"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.N">[docs]</a>    <span class="k">def</span> <span class="nf">N</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Location.hasData"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.hasData">[docs]</a>    <span class="k">def</span> <span class="nf">hasData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Location.all_positive"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.all_positive">[docs]</a>    <span class="k">def</span> <span class="nf">all_positive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span> <span class="o">&gt;</span> <span class="mi">0</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Location.ND"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.ND">[docs]</a>    <span class="k">def</span> <span class="nf">ND</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cencol</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Location.NUnique"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.NUnique">[docs]</a>    <span class="k">def</span> <span class="nf">NUnique</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Location.fractionND"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.fractionND">[docs]</a>    <span class="k">def</span> <span class="nf">fractionND</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ND</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span></div>

    <span class="nd">@cache_readonly</span>
    <span class="nd">@np.deprecate</span>
    <span class="k">def</span> <span class="nf">pnorm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">stats</span><span class="o">.</span><span class="n">shapiro</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

    <span class="nd">@cache_readonly</span>
    <span class="nd">@np.deprecate</span>
    <span class="k">def</span> <span class="nf">plognorm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">stats</span><span class="o">.</span><span class="n">shapiro</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))[</span><span class="mi">1</span><span class="p">]</span>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Location.shapiro"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.shapiro">[docs]</a>    <span class="k">def</span> <span class="nf">shapiro</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="k">return</span>  <span class="n">stats</span><span class="o">.</span><span class="n">shapiro</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Location.shapiro_log"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.shapiro_log">[docs]</a>    <span class="k">def</span> <span class="nf">shapiro_log</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">stats</span><span class="o">.</span><span class="n">shapiro</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Location.lilliefors"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.lilliefors">[docs]</a>    <span class="k">def</span> <span class="nf">lilliefors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sm</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">lillifors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Location.lilliefors_log"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.lilliefors_log">[docs]</a>    <span class="k">def</span> <span class="nf">lilliefors_log</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sm</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">lillifors</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Location.anderson"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.anderson">[docs]</a>    <span class="k">def</span> <span class="nf">anderson</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="k">return</span>  <span class="n">stats</span><span class="o">.</span><span class="n">anderson</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Location.anderson_log"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.anderson_log">[docs]</a>    <span class="k">def</span> <span class="nf">anderson_log</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">stats</span><span class="o">.</span><span class="n">anderson</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Location.analysis_space"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.analysis_space">[docs]</a>    <span class="k">def</span> <span class="nf">analysis_space</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plognorm</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pnorm</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">plognorm</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;lognormal&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;normal&#39;</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Location.cov"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.cov">[docs]</a>    <span class="k">def</span> <span class="nf">cov</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
           <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Location.min"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.min">[docs]</a>    <span class="k">def</span> <span class="nf">min</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">()</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Location.min_detect"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.min_detect">[docs]</a>    <span class="k">def</span> <span class="nf">min_detect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rescol</span><span class="p">][</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">qualcol</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndvals</span><span class="p">)]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Location.min_DL"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.min_DL">[docs]</a>    <span class="k">def</span> <span class="nf">min_DL</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rescol</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">qualcol</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndvals</span><span class="p">)]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Location.max"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.max">[docs]</a>    <span class="k">def</span> <span class="nf">max</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Location.skew"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.skew">[docs]</a>    <span class="k">def</span> <span class="nf">skew</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">stats</span><span class="o">.</span><span class="n">skew</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Location.pctl10"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.pctl10">[docs]</a>    <span class="k">def</span> <span class="nf">pctl10</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">stats</span><span class="o">.</span><span class="n">scoreatpercentile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Location.pctl25"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.pctl25">[docs]</a>    <span class="k">def</span> <span class="nf">pctl25</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">stats</span><span class="o">.</span><span class="n">scoreatpercentile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Location.pctl75"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.pctl75">[docs]</a>    <span class="k">def</span> <span class="nf">pctl75</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">stats</span><span class="o">.</span><span class="n">scoreatpercentile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Location.pctl90"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.pctl90">[docs]</a>    <span class="k">def</span> <span class="nf">pctl90</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">stats</span><span class="o">.</span><span class="n">scoreatpercentile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span></div>

    <span class="c1"># stats that we need</span>
    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Location.median"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.median">[docs]</a>    <span class="k">def</span> <span class="nf">median</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_median_boostrap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Location.median_conf_interval"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.median_conf_interval">[docs]</a>    <span class="k">def</span> <span class="nf">median_conf_interval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_median_boostrap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Location.mean"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.mean">[docs]</a>    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mean_boostrap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Location.mean_conf_interval"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.mean_conf_interval">[docs]</a>    <span class="k">def</span> <span class="nf">mean_conf_interval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mean_boostrap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Location.std"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.std">[docs]</a>    <span class="k">def</span> <span class="nf">std</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Location.logmean"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.logmean">[docs]</a>    <span class="k">def</span> <span class="nf">logmean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_positive</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Location.logmean_conf_interval"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.logmean_conf_interval">[docs]</a>    <span class="k">def</span> <span class="nf">logmean_conf_interval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_positive</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logmean_boostrap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Location.logstd"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.logstd">[docs]</a>    <span class="k">def</span> <span class="nf">logstd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_positive</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Location.geomean"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.geomean">[docs]</a>    <span class="k">def</span> <span class="nf">geomean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_positive</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logmean</span><span class="p">)</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Location.geomean_conf_interval"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.geomean_conf_interval">[docs]</a>    <span class="k">def</span> <span class="nf">geomean_conf_interval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_positive</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logmean_conf_interval</span><span class="p">)</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Location.geostd"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.geostd">[docs]</a>    <span class="k">def</span> <span class="nf">geostd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_positive</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logstd</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span></div>

    <span class="c1"># helper bootstrap objects</span>
    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">_median_boostrap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">bootstrap</span><span class="o">.</span><span class="n">BCA</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">,</span> <span class="n">niter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bsIter</span><span class="p">)</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">_mean_boostrap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">bootstrap</span><span class="o">.</span><span class="n">BCA</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">niter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bsIter</span><span class="p">)</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">_std_boostrap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">bootstrap</span><span class="o">.</span><span class="n">BCA</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">,</span> <span class="n">niter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bsIter</span><span class="p">)</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">_logmean_boostrap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_positive</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">bootstrap</span><span class="o">.</span><span class="n">BCA</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">niter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bsIter</span><span class="p">)</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">_logstd_boostrap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_positive</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">bootstrap</span><span class="o">.</span><span class="n">BCA</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">,</span> <span class="n">niter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bsIter</span><span class="p">)</span>

<div class="viewcode-block" id="Location.boxplot_stats"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.boxplot_stats">[docs]</a>    <span class="k">def</span> <span class="nf">boxplot_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">bacteria</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">bxpstats</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">geomean</span> <span class="k">if</span> <span class="n">bacteria</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span>
            <span class="s1">&#39;med&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">median</span><span class="p">,</span>
            <span class="s1">&#39;q1&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pctl25</span><span class="p">,</span>
            <span class="s1">&#39;q3&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pctl75</span><span class="p">,</span>
            <span class="s1">&#39;cilo&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">median_conf_interval</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="s1">&#39;cihi&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">median_conf_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
            <span class="n">wnf</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">figutils</span><span class="o">.</span><span class="n">whiskers_and_fliers</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pctl25</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pctl75</span><span class="p">),</span>
                <span class="n">transformout</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wnf</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">figutils</span><span class="o">.</span><span class="n">whiskers_and_fliers</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pctl25</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pctl75</span><span class="p">,</span>
                <span class="n">transformout</span><span class="o">=</span><span class="bp">None</span>
            <span class="p">)</span>

        <span class="n">bxpstats</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">wnf</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">bxpstats</span><span class="p">]</span></div>

    <span class="c1"># plotting methods</span>
<div class="viewcode-block" id="Location.boxplot"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.boxplot">[docs]</a>    <span class="k">def</span> <span class="nf">boxplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">notch</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">showmean</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                <span class="n">width</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">bacteria</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">minpoints</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                <span class="n">patch_artist</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">xlims</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Draws a boxplot and whisker on a matplotlib figure</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ax : optional matplotlib axes object or None (default)</span>
<span class="sd">            Axes on which the boxplot with be drawn. If None, one will</span>
<span class="sd">            be created.</span>
<span class="sd">        pos : optional int (default=1)</span>
<span class="sd">            Location along x-axis where boxplot will be placed.</span>
<span class="sd">        yscale : optional string [&#39;linear&#39; or &#39;log&#39; (default)]</span>
<span class="sd">            Scale formatting of the y-axis</span>
<span class="sd">        notch : optional bool (default=True)</span>
<span class="sd">            Toggles drawing of bootstrapped confidence interval around</span>
<span class="sd">            the median.</span>
<span class="sd">        showmean : optional bool (default=True)</span>
<span class="sd">            Toggles plotting the mean value on the boxplot as a point.</span>
<span class="sd">            See also the `bacteria` kwarg</span>
<span class="sd">        width : optional float (default=0.8)</span>
<span class="sd">            Width of boxplot on the axes (data units)</span>
<span class="sd">        bacteria : optional bool (default False)</span>
<span class="sd">            If True, uses the geometric mean when `showmean` is True.</span>
<span class="sd">            Otherwise, the arithmetic mean is used.</span>
<span class="sd">        ylabel : string or None (default):</span>
<span class="sd">            Label for y-axis</span>
<span class="sd">        xlabel : string or None (default):</span>
<span class="sd">            Label for x-axis. If None, uses self.name</span>
<span class="sd">        minpoints : int, optional (default = 5)</span>
<span class="sd">            The minimum number of data points required to draw a</span>
<span class="sd">            boxplot. If too few points are present, the drawing will</span>
<span class="sd">            fallback to a verticalScatter plot.</span>
<span class="sd">        patch_artist : optional bool (default = False)</span>
<span class="sd">            Toggles the use of patch artist instead of a line artists</span>
<span class="sd">            for the boxes</span>
<span class="sd">        xlims : dict, optional</span>
<span class="sd">            Dictionary of limits for the x-axis. Keys must be either</span>
<span class="sd">            &quot;left&quot;, &quot;right&quot;, or both</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig : matplotlib Figure</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">figutils</span><span class="o">.</span><span class="n">_check_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

        <span class="n">meankwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">marker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_marker</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">markerfacecolor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;Black&#39;</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">&gt;=</span> <span class="n">minpoints</span><span class="p">:</span>
            <span class="n">bxpstats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boxplot_stats</span><span class="p">(</span><span class="n">log</span><span class="o">=</span><span class="n">yscale</span><span class="o">==</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">bacteria</span><span class="o">=</span><span class="n">bacteria</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">bxpstats</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xlabel</span>

            <span class="n">bp</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bxp</span><span class="p">(</span><span class="n">bxpstats</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span> <span class="n">widths</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                        <span class="n">showmeans</span><span class="o">=</span><span class="n">showmean</span><span class="p">,</span> <span class="n">shownotches</span><span class="o">=</span><span class="n">notch</span><span class="p">,</span> <span class="n">showcaps</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                        <span class="n">manage_xticks</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">patch_artist</span><span class="o">=</span><span class="n">patch_artist</span><span class="p">,</span>
                        <span class="n">meanprops</span><span class="o">=</span><span class="n">meankwargs</span><span class="p">)</span>

            <span class="n">utils</span><span class="o">.</span><span class="n">figutils</span><span class="o">.</span><span class="n">formatBoxplot</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_marker</span><span class="p">,</span>
                                         <span class="n">patch_artist</span><span class="o">=</span><span class="n">patch_artist</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verticalScatter</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">jitter</span><span class="o">=</span><span class="n">width</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span>
                                 <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="n">yscale</span><span class="p">,</span> <span class="n">ignoreROS</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="n">yscale</span><span class="p">)</span>
        <span class="n">label_format</span> <span class="o">=</span> <span class="n">mticker</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">figutils</span><span class="o">.</span><span class="n">alt_logLabelFormatter</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">yscale</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">label_format</span><span class="p">)</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">figutils</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">yminor</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ylabel</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="n">pos</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="n">xlabel</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">xlims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">**</span><span class="n">xlims</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="Location.probplot"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.probplot">[docs]</a>    <span class="k">def</span> <span class="nf">probplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">axtype</span><span class="o">=</span><span class="s1">&#39;prob&#39;</span><span class="p">,</span>
                 <span class="n">ylabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">clearYLabels</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">managegrid</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">rotateticklabels</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">setxlimits</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">bestfit</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">plotopts</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Draws a probability plot on a matplotlib figure</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ax : matplotlib axes object, optional or None (default).</span>
<span class="sd">            The Axes on which to plot. If None is provided, one will be</span>
<span class="sd">            created.</span>
<span class="sd">        axtype : string, optional (default = &#39;pp&#39;)</span>
<span class="sd">            Type of plot to be created. Options are:</span>
<span class="sd">                - &#39;prob&#39;: probabilty plot</span>
<span class="sd">                - &#39;pp&#39;: percentile plot</span>
<span class="sd">                - &#39;qq&#39;: quantile plot</span>
<span class="sd">        xlabel, ylabel : string, optional or None (default)</span>
<span class="sd">            Axis label for the plot.</span>
<span class="sd">        yscale : string , optional(default = &#39;log&#39;)</span>
<span class="sd">            Scale for the y-axis. Use &#39;log&#39; for logarithmic (default) or</span>
<span class="sd">            &#39;linear&#39;.</span>
<span class="sd">        clearYLabels : bool, optional (default is False)</span>
<span class="sd">            If True, removed y-*tick* labels from teh Axes.</span>
<span class="sd">        managegrid : bool, optional (default is True)</span>
<span class="sd">            If True, typical gridlines will be added to the Axes.</span>
<span class="sd">        rotateticklabels : bool, optional (default is True)</span>
<span class="sd">            If True, the tick labels of the probability axes will be</span>
<span class="sd">            rotated.</span>
<span class="sd">        setxlimits : bool, optional (default is True)</span>
<span class="sd">            If True and `axtype` == &#39;prob&#39;, tehe axis limits will be</span>
<span class="sd">            automatically set based on the number of points in the plot.</span>
<span class="sd">        bestfit : bool, optional (default is False)</span>
<span class="sd">            Specifies whether a best-fit line should be added to the</span>
<span class="sd">            plot.</span>
<span class="sd">        plotopts : keyword arguments</span>
<span class="sd">            Additional options passed directly to `plt.plot` when</span>
<span class="sd">            drawing the data points.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig : matplotlib.Figure instance</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">figutils</span><span class="o">.</span><span class="n">_check_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

        <span class="n">scatter_kws</span> <span class="o">=</span> <span class="n">plotopts</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">scatter_kws</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotopts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">)</span>
        <span class="n">scatter_kws</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotopts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">scatter_kws</span><span class="p">[</span><span class="s1">&#39;marker&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotopts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;marker&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_marker</span><span class="p">)</span>
        <span class="n">scatter_kws</span><span class="p">[</span><span class="s1">&#39;linestyle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotopts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;linestyle&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">figutils</span><span class="o">.</span><span class="n">probplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">axtype</span><span class="o">=</span><span class="n">axtype</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="n">yscale</span><span class="p">,</span>
                                      <span class="n">bestfit</span><span class="o">=</span><span class="n">bestfit</span><span class="p">,</span> <span class="n">scatter_kws</span><span class="o">=</span><span class="n">scatter_kws</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">yscale</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
            <span class="k">pass</span>
            <span class="c1"># label_format = mticker.FuncFormatter(</span>
            <span class="c1">#     utils.figutils.alt_logLabelFormatter</span>
            <span class="c1"># )</span>
            <span class="c1"># ax.yaxis.set_major_formatter(label_format)</span>

        <span class="k">if</span> <span class="n">managegrid</span><span class="p">:</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">figutils</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">yminor</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">clearYLabels</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>

        <span class="k">if</span> <span class="n">rotateticklabels</span><span class="p">:</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">figutils</span><span class="o">.</span><span class="n">rotateTickLabels</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">setxlimits</span> <span class="ow">and</span> <span class="n">axtype</span> <span class="o">==</span> <span class="s1">&#39;prob&#39;</span><span class="p">:</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">figutils</span><span class="o">.</span><span class="n">setProbLimits</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bestfit</span><span class="p">:</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">fit_line</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="Location.statplot"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.statplot">[docs]</a>    <span class="k">def</span> <span class="nf">statplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">notch</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">showmean</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">width</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">bacteria</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">axtype</span><span class="o">=</span><span class="s1">&#39;prob&#39;</span><span class="p">,</span> <span class="n">patch_artist</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">plotopts</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates a two-axis figure with a boxplot &amp; probability plot.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pos : int, optional (default=1)</span>
<span class="sd">            Location along x-axis where boxplot will be placed.</span>
<span class="sd">        yscale : string, optional [&#39;linear&#39; or &#39;log&#39; (default)]</span>
<span class="sd">            Scale formatting of the y-axis</span>
<span class="sd">        notch : bool, optional (default=True)</span>
<span class="sd">            Toggles drawing of bootstrapped confidence interval around</span>
<span class="sd">            the median.</span>
<span class="sd">        showmean : bool, optional (default=True)</span>
<span class="sd">            Toggles plotting the mean value on the boxplot as a point.</span>
<span class="sd">            See also the `bacteria` kwarg</span>
<span class="sd">        width : float, optional (default=0.8)</span>
<span class="sd">            Width of boxplot on the axes (data units)</span>
<span class="sd">        bacteria : bool, optional (default False)</span>
<span class="sd">            If True, uses the geometric mean when `showmean` is True.</span>
<span class="sd">            Otherwise, the arithmetic mean is used.</span>
<span class="sd">        ylabel : string, optional or None (default):</span>
<span class="sd">            Label for y-axis</span>
<span class="sd">        xlabel : string or None (default):</span>
<span class="sd">            Label for x-axis of boxplot. If None, uses self.name</span>
<span class="sd">        axtype : string, optional (default = &#39;pp&#39;)</span>
<span class="sd">            Type of probability plot to be created. Options are:</span>
<span class="sd">                - &#39;prob&#39;: probabilty plot</span>
<span class="sd">                - &#39;pp&#39;: percentile plot</span>
<span class="sd">                - &#39;qq&#39;: quantile plot</span>
<span class="sd">        patch_artist : bool, optional (default = False)</span>
<span class="sd">            Toggles the use of patch artist instead of a line artists</span>
<span class="sd">            for the boxes</span>
<span class="sd">        plotopts : keyword arguments</span>
<span class="sd">            Additional options passed directly to `plt.plot` when</span>
<span class="sd">            drawing the data points on the probability plots.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig : matplotlib Figure</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># setup the figure and axes</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">6.40</span><span class="p">,</span> <span class="mf">3.00</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                         <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
        <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="n">yscale</span><span class="p">,</span> <span class="n">notch</span><span class="o">=</span><span class="n">notch</span><span class="p">,</span>
                     <span class="n">showmean</span><span class="o">=</span><span class="n">showmean</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">bacteria</span><span class="o">=</span><span class="n">bacteria</span><span class="p">,</span>
                     <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">patch_artist</span><span class="o">=</span><span class="n">patch_artist</span><span class="p">,</span>
                     <span class="n">xlims</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;left&#39;</span><span class="p">:</span> <span class="n">pos</span> <span class="o">-</span> <span class="p">(</span><span class="mf">0.6</span><span class="o">*</span><span class="n">width</span><span class="p">),</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span> <span class="n">pos</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.6</span><span class="o">*</span><span class="n">width</span><span class="p">)})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">probplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="n">yscale</span><span class="p">,</span> <span class="n">axtype</span><span class="o">=</span><span class="n">axtype</span><span class="p">,</span>
                      <span class="n">ylabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">clearYLabels</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">plotopts</span><span class="p">)</span>

        <span class="n">ax1</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">tick_left</span><span class="p">()</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">tick_right</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="Location.verticalScatter"><a class="viewcode-back" href="../../api/features.html#wqio.features.Location.verticalScatter">[docs]</a>    <span class="k">def</span> <span class="nf">verticalScatter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">jitter</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span>
                        <span class="n">ylabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">ignoreROS</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                        <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">xlims</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Draws a clustered &amp; jittered scatter plot of the data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ax : matplotlib axes object, optional or None (default)</span>
<span class="sd">            Axes on which the points with be drawn. If None, one will</span>
<span class="sd">            be created.</span>
<span class="sd">        pos : int, optional (default=1)</span>
<span class="sd">            Location along x-axis where data will be centered.</span>
<span class="sd">        jitter : float, optional (default=0.80)</span>
<span class="sd">            Width of the random x-values uniform distributed around</span>
<span class="sd">            `pos`</span>
<span class="sd">        alpha : float, optional (default=0.75)</span>
<span class="sd">            Opacity of the marker (1.0 -&gt; opaque; 0.0 -&gt; transparent)</span>
<span class="sd">        yscale : string, optional [&#39;linear&#39; or &#39;log&#39; (default)]</span>
<span class="sd">            Scale formatting of the y-axis</span>
<span class="sd">        ylabel : string, optional or None (default):</span>
<span class="sd">            Label for y-axis</span>
<span class="sd">        ignoreROS : bool, optional (default = True)</span>
<span class="sd">            By default, this function will plot the original, non-ROS&#39;d</span>
<span class="sd">            data with a different symbol for non-detects. If `True`, the</span>
<span class="sd">            and `self.useROS` is `True`, this function will plot the</span>
<span class="sd">            ROS&#39;d data with a single marker.</span>
<span class="sd">        markersize : int, optional (default = 6)</span>
<span class="sd">            Size of data markers on the figure in points.</span>
<span class="sd">        xlims : dict, optional</span>
<span class="sd">            Dictionary of limits for the x-axis. Keys must be either</span>
<span class="sd">            &quot;left&quot;, &quot;right&quot;, or both</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig : matplotlib Figure</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">figutils</span><span class="o">.</span><span class="n">_check_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">jitter</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">xvals</span> <span class="o">=</span> <span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">low</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">-</span> <span class="n">jitter</span> <span class="o">*</span> <span class="mf">0.5</span>
            <span class="n">high</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">jitter</span> <span class="o">*</span> <span class="mf">0.5</span>
            <span class="n">xvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">high</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ignoreROS</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">useROS</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xvals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_marker</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span>
                    <span class="n">markerfacecolor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y_nondet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cencol</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rescol</span><span class="p">]</span>
            <span class="n">y_detect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cencol</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rescol</span><span class="p">]</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xvals</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">ND</span><span class="p">],</span> <span class="n">y_nondet</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span>
                    <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Non-detects&#39;</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xvals</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ND</span><span class="p">:],</span> <span class="n">y_detect</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_marker</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span>
                    <span class="n">markerfacecolor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Detects&#39;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="n">yscale</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">xlims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">**</span><span class="n">xlims</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span></div></div>


<div class="viewcode-block" id="Dataset"><a class="viewcode-back" href="../../api/features.html#wqio.features.Dataset">[docs]</a><span class="k">class</span> <span class="nc">Dataset</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Dataset: object for comparings two Location objects</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    influent, effluent : wqio.Location</span>
<span class="sd">        Location objects that will be compared. Data from each Location</span>
<span class="sd">        should be joinable on the dataframe&#39;s index.</span>
<span class="sd">    useROS : bool (default = True)</span>
<span class="sd">        Toggles the use of Regression On Order Statistics to</span>
<span class="sd">        estimate non-detect values when computing statistics.</span>
<span class="sd">    name : string optional</span>
<span class="sd">        Name for the dataset.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Currently moving away from this in favor of DataCollections.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># TODO: constructor should take dataframe, and build Location object,</span>
    <span class="c1"># not the other way around. This will allow Dataset.influent = None</span>
    <span class="c1"># by passing in a dataframe where df.shape[0] == 0</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">influent</span><span class="p">,</span> <span class="n">effluent</span><span class="p">,</span> <span class="n">useROS</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="c1"># basic attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">influent</span> <span class="o">=</span> <span class="n">influent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">effluent</span> <span class="o">=</span> <span class="n">effluent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_include</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">useROS</span> <span class="o">=</span> <span class="n">useROS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_definition</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span> <span class="o">=</span> <span class="n">resettable_cache</span><span class="p">()</span>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Dataset.data"><a class="viewcode-back" href="../../api/features.html#wqio.features.Dataset.data">[docs]</a>    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">effluent</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="n">effl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">effluent</span><span class="o">.</span><span class="n">raw_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;effluent must have data&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">influent</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="n">infl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">influent</span><span class="o">.</span><span class="n">raw_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">infl</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">effluent</span><span class="o">.</span><span class="n">raw_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">effluent</span><span class="o">.</span><span class="n">raw_data</span><span class="o">.</span><span class="n">columns</span>
            <span class="p">)</span>

        <span class="n">infl</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">addSecondColumnLevel</span><span class="p">(</span><span class="s1">&#39;inflow&#39;</span><span class="p">,</span> <span class="s1">&#39;station&#39;</span><span class="p">,</span> <span class="n">infl</span><span class="p">)</span>
        <span class="n">effl</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">addSecondColumnLevel</span><span class="p">(</span><span class="s1">&#39;outflow&#39;</span><span class="p">,</span> <span class="s1">&#39;station&#39;</span><span class="p">,</span> <span class="n">effl</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">infl</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">effl</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Dataset.paired_data"><a class="viewcode-back" href="../../api/features.html#wqio.features.Dataset.paired_data">[docs]</a>    <span class="k">def</span> <span class="nf">paired_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Dataset.n_pairs"><a class="viewcode-back" href="../../api/features.html#wqio.features.Dataset.n_pairs">[docs]</a>    <span class="k">def</span> <span class="nf">n_pairs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">paired_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">paired_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span></div>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">_non_paired_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">influent</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">effluent</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">_paired_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_non_paired_stats</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">paired_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">20</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;&lt;openpybmp Dataset object&gt;</span><span class="se">\n</span><span class="s2">  N influent  {0}</span><span class="se">\n</span><span class="s2">  N effluent = {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">influent</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">effluent</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">definition</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">definition</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;{0}</span><span class="se">\n</span><span class="s2">  {1} = {2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>
    <span class="nd">@name.setter</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">definition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_definition</span>
    <span class="nd">@definition.setter</span>
    <span class="k">def</span> <span class="nf">definition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_definition</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">include</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_include</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_include</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">influent</span><span class="o">.</span><span class="n">include</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">effluent</span><span class="o">.</span><span class="n">include</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_include</span>
    <span class="nd">@include.setter</span>
    <span class="k">def</span> <span class="nf">include</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_include</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">exclude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">include</span>

    <span class="c1"># stats describing the dataset</span>
    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Dataset.medianCIsOverlap"><a class="viewcode-back" href="../../api/features.html#wqio.features.Dataset.medianCIsOverlap">[docs]</a>    <span class="k">def</span> <span class="nf">medianCIsOverlap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">overlap</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">influent</span><span class="o">.</span><span class="n">hasData</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">effluent</span><span class="o">.</span><span class="n">hasData</span><span class="p">:</span>
            <span class="n">overlap</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">checkIntervalOverlap</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">influent</span><span class="o">.</span><span class="n">median_conf_interval</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">effluent</span><span class="o">.</span><span class="n">median_conf_interval</span><span class="p">,</span>
                <span class="n">oneway</span><span class="o">=</span><span class="bp">False</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">overlap</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Dataset.wilcoxon_z"><a class="viewcode-back" href="../../api/features.html#wqio.features.Dataset.wilcoxon_z">[docs]</a>    <span class="k">def</span> <span class="nf">wilcoxon_z</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The Wilcoxon Z-statistic.</span>

<span class="sd">        Tests the null hypothesis that the influent and effluent data are</span>
<span class="sd">        sampled from the same statistical distribution.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Operates on natural log-transormed paired data only.</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        scipy.stats.wilcoxon</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wilcoxon_stats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wilcoxon_stats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Dataset.wilcoxon_p"><a class="viewcode-back" href="../../api/features.html#wqio.features.Dataset.wilcoxon_p">[docs]</a>    <span class="k">def</span> <span class="nf">wilcoxon_p</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Two-sided p-value of the Wilcoxon test</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        scipy.stats.wilcoxon</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wilcoxon_stats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wilcoxon_stats</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Dataset.mannwhitney_u"><a class="viewcode-back" href="../../api/features.html#wqio.features.Dataset.mannwhitney_u">[docs]</a>    <span class="k">def</span> <span class="nf">mannwhitney_u</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Mann-Whitney U-statistic.</span>

<span class="sd">        Performs a basic rank-sum test.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Operates on untransformed, non-paired data.</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        scipy.stats.mannwhitneyu</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mannwhitney_stats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mannwhitney_stats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Dataset.mannwhitney_p"><a class="viewcode-back" href="../../api/features.html#wqio.features.Dataset.mannwhitney_p">[docs]</a>    <span class="k">def</span> <span class="nf">mannwhitney_p</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Two-sided p-value of the Mann-Whitney test</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Scipy functions returns the 1-sided p-values. This corrects for that.</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        scipy.stats.mannwhitneyu</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mannwhitney_stats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mannwhitney_stats</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Dataset.kendall_tau"><a class="viewcode-back" href="../../api/features.html#wqio.features.Dataset.kendall_tau">[docs]</a>    <span class="k">def</span> <span class="nf">kendall_tau</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The Kendall-Tau statistic.</span>

<span class="sd">        Measure of the correspondence between two the rankings of influent</span>
<span class="sd">        and effluent data.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Operates on paired data only.</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        scipy.stats.kendalltau</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kendall_stats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kendall_stats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Dataset.kendall_p"><a class="viewcode-back" href="../../api/features.html#wqio.features.Dataset.kendall_p">[docs]</a>    <span class="k">def</span> <span class="nf">kendall_p</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Two-sided p-value of the Kendall test</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        scipy.stats.kendalltau</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kendall_stats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kendall_stats</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Dataset.spearman_rho"><a class="viewcode-back" href="../../api/features.html#wqio.features.Dataset.spearman_rho">[docs]</a>    <span class="k">def</span> <span class="nf">spearman_rho</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The Spearman&#39;s rho statistic.</span>

<span class="sd">        Tests for monotonicity of the relationship between influent and.</span>
<span class="sd">        effluent data.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Operates on paired data only.</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        scipy.stats.spearmanr</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spearman_stats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spearman_stats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Dataset.spearman_p"><a class="viewcode-back" href="../../api/features.html#wqio.features.Dataset.spearman_p">[docs]</a>    <span class="k">def</span> <span class="nf">spearman_p</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Two-sided p-value of the Spearman test</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        scipy.stats.spearmanr</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spearman_stats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spearman_stats</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Dataset.ttest_t"><a class="viewcode-back" href="../../api/features.html#wqio.features.Dataset.ttest_t">[docs]</a>    <span class="k">def</span> <span class="nf">ttest_t</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ttest_stats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Dataset.ttest_p"><a class="viewcode-back" href="../../api/features.html#wqio.features.Dataset.ttest_p">[docs]</a>    <span class="k">def</span> <span class="nf">ttest_p</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ttest_stats</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Dataset.levene_ks"><a class="viewcode-back" href="../../api/features.html#wqio.features.Dataset.levene_ks">[docs]</a>    <span class="k">def</span> <span class="nf">levene_ks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_levene_stats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Dataset.levene_p"><a class="viewcode-back" href="../../api/features.html#wqio.features.Dataset.levene_p">[docs]</a>    <span class="k">def</span> <span class="nf">levene_p</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_levene_stats</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Dataset.theil_medslope"><a class="viewcode-back" href="../../api/features.html#wqio.features.Dataset.theil_medslope">[docs]</a>    <span class="k">def</span> <span class="nf">theil_medslope</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_theil_stats</span><span class="p">[</span><span class="s1">&#39;medslope&#39;</span><span class="p">]</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Dataset.theil_intercept"><a class="viewcode-back" href="../../api/features.html#wqio.features.Dataset.theil_intercept">[docs]</a>    <span class="k">def</span> <span class="nf">theil_intercept</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_theil_stats</span><span class="p">[</span><span class="s1">&#39;intercept&#39;</span><span class="p">]</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Dataset.theil_loslope"><a class="viewcode-back" href="../../api/features.html#wqio.features.Dataset.theil_loslope">[docs]</a>    <span class="k">def</span> <span class="nf">theil_loslope</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_theil_stats</span><span class="p">[</span><span class="s1">&#39;loslope&#39;</span><span class="p">]</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="Dataset.theil_hislope"><a class="viewcode-back" href="../../api/features.html#wqio.features.Dataset.theil_hislope">[docs]</a>    <span class="k">def</span> <span class="nf">theil_hislope</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_theil_stats</span><span class="p">[</span><span class="s1">&#39;hislope&#39;</span><span class="p">]</span></div>

    <span class="c1"># helper objects for the stats</span>
    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">_wilcoxon_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paired_stats</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">stats</span><span class="o">.</span><span class="n">wilcoxon</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paired_data</span><span class="o">.</span><span class="n">inflow</span><span class="o">.</span><span class="n">res</span><span class="p">),</span>
                                  <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paired_data</span><span class="o">.</span><span class="n">outflow</span><span class="o">.</span><span class="n">res</span><span class="p">))</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">_mannwhitney_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_non_paired_stats</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">stats</span><span class="o">.</span><span class="n">mannwhitneyu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">influent</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">effluent</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                      <span class="n">alternative</span><span class="o">=</span><span class="s1">&#39;two-sided&#39;</span><span class="p">)</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">_kendall_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paired_stats</span> <span class="ow">and</span> \
        <span class="bp">self</span><span class="o">.</span><span class="n">influent</span><span class="o">.</span><span class="n">fractionND</span> <span class="o">&lt;=</span> <span class="mf">0.5</span> <span class="ow">and</span> \
        <span class="bp">self</span><span class="o">.</span><span class="n">effluent</span><span class="o">.</span><span class="n">fractionND</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">stats</span><span class="o">.</span><span class="n">kendalltau</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paired_data</span><span class="o">.</span><span class="n">inflow</span><span class="o">.</span><span class="n">res</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">paired_data</span><span class="o">.</span><span class="n">outflow</span><span class="o">.</span><span class="n">res</span><span class="p">)</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">_spearman_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paired_stats</span> <span class="ow">and</span> \
        <span class="bp">self</span><span class="o">.</span><span class="n">influent</span><span class="o">.</span><span class="n">fractionND</span> <span class="o">&lt;=</span> <span class="mf">0.5</span> <span class="ow">and</span> \
        <span class="bp">self</span><span class="o">.</span><span class="n">effluent</span><span class="o">.</span><span class="n">fractionND</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">stats</span><span class="o">.</span><span class="n">spearmanr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paired_data</span><span class="o">.</span><span class="n">inflow</span><span class="o">.</span><span class="n">res</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">paired_data</span><span class="o">.</span><span class="n">outflow</span><span class="o">.</span><span class="n">res</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">_ttest_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_non_paired_stats</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">influent</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">effluent</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">_levene_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_non_paired_stats</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">stats</span><span class="o">.</span><span class="n">levene</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">influent</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">effluent</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">)</span>

    <span class="nd">@cache_readonly</span>
    <span class="k">def</span> <span class="nf">_theil_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">theilSlopes</span><span class="p">()</span>

<div class="viewcode-block" id="Dataset.theilSlopes"><a class="viewcode-back" href="../../api/features.html#wqio.features.Dataset.theilSlopes">[docs]</a>    <span class="k">def</span> <span class="nf">theilSlopes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log_infl</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">log_effl</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">None</span> <span class="c1">#default</span>
        <span class="c1"># influent data</span>
        <span class="n">infl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">paired_data</span><span class="o">.</span><span class="n">inflow</span><span class="o">.</span><span class="n">res</span><span class="o">.</span><span class="n">values</span>
        <span class="k">if</span> <span class="n">log_infl</span><span class="p">:</span>
            <span class="n">infl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">infl</span><span class="p">)</span>

        <span class="c1"># effluent data</span>
        <span class="n">effl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">paired_data</span><span class="o">.</span><span class="n">outflow</span><span class="o">.</span><span class="n">res</span><span class="o">.</span><span class="n">values</span>
        <span class="k">if</span> <span class="n">log_effl</span><span class="p">:</span>
            <span class="n">effl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">effl</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paired_stats</span> <span class="ow">and</span> \
        <span class="bp">self</span><span class="o">.</span><span class="n">influent</span><span class="o">.</span><span class="n">fractionND</span> <span class="o">&lt;=</span> <span class="mf">0.5</span> <span class="ow">and</span> \
        <span class="bp">self</span><span class="o">.</span><span class="n">effluent</span><span class="o">.</span><span class="n">fractionND</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="c1"># we need to make sure that the &quot;y&quot; values are the</span>
            <span class="c1"># Location with the greatest NUnique to avoid a</span>
            <span class="c1"># slope of zero if possible</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">influent</span><span class="o">.</span><span class="n">NUnique</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">effluent</span><span class="o">.</span><span class="n">NUnique</span><span class="p">:</span>
                <span class="n">inverted</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="n">theilstats</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">mstats</span><span class="o">.</span><span class="n">theilslopes</span><span class="p">(</span><span class="n">effl</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">infl</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">inverted</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">theilstats</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">mstats</span><span class="o">.</span><span class="n">theilslopes</span><span class="p">(</span><span class="n">infl</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">effl</span><span class="p">)</span>

            <span class="c1"># stuff things into a dictionary</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">inverted</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;medslope&#39;</span><span class="p">:</span> <span class="n">theilstats</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s1">&#39;intercept&#39;</span><span class="p">:</span> <span class="n">theilstats</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="s1">&#39;loslope&#39;</span><span class="p">:</span> <span class="n">theilstats</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                    <span class="s1">&#39;hislope&#39;</span><span class="p">:</span> <span class="n">theilstats</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                    <span class="s1">&#39;is_inverted&#39;</span><span class="p">:</span> <span class="n">inverted</span>
                <span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;medslope&#39;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">theilstats</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s1">&#39;intercept&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">theilstats</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">theilstats</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s1">&#39;loslope&#39;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">theilstats</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                    <span class="s1">&#39;hislope&#39;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">theilstats</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                    <span class="s1">&#39;is_inverted&#39;</span><span class="p">:</span> <span class="n">inverted</span>
                <span class="p">}</span>

            <span class="n">output</span><span class="p">[</span><span class="s1">&#39;estimated_effluent&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">utils</span><span class="o">.</span><span class="n">estimateFromLineParams</span><span class="p">(</span><span class="n">infl</span><span class="p">,</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;medslope&#39;</span><span class="p">],</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;intercept&#39;</span><span class="p">],</span>
                                             <span class="n">xlog</span><span class="o">=</span><span class="n">log_infl</span><span class="p">,</span> <span class="n">ylog</span><span class="o">=</span><span class="n">log_effl</span><span class="p">)</span>

            <span class="n">output</span><span class="p">[</span><span class="s1">&#39;estimate_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">paired_data</span><span class="o">.</span><span class="n">outflow</span><span class="o">.</span><span class="n">res</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> \
                                       <span class="n">output</span><span class="p">[</span><span class="s1">&#39;estimated_effluent&#39;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">output</span></div>

    <span class="c1"># plotting methods</span>
<div class="viewcode-block" id="Dataset.boxplot"><a class="viewcode-back" href="../../api/features.html#wqio.features.Dataset.boxplot">[docs]</a>    <span class="k">def</span> <span class="nf">boxplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">notch</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                <span class="n">showmean</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">bacteria</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                <span class="n">xlims</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">bothTicks</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                <span class="n">patch_artist</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">minpoints</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Adds a boxplot to a matplotlib figure</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ax : matplotlib axes object or None (default), optional</span>
<span class="sd">            Axes on which the boxplot with be drawn. If None, one will</span>
<span class="sd">            be created.</span>
<span class="sd">        pos : int, optional (default=1)</span>
<span class="sd">            Location along x-axis where boxplot will be placed.</span>
<span class="sd">        yscale : optional string [&#39;linear&#39; or &#39;log&#39; (default)]</span>
<span class="sd">            Scale formatting of the y-axis</span>
<span class="sd">        notch : bool, optional (default=True)</span>
<span class="sd">            Toggles drawing of bootstrapped confidence interval around</span>
<span class="sd">            the median.</span>
<span class="sd">        showmean : bool, optional (default is True)</span>
<span class="sd">            Toggles plotting the mean value on the boxplot as a point.</span>
<span class="sd">            See also the `bacteria` kwarg</span>
<span class="sd">        width : float, optional (default=0.8)</span>
<span class="sd">            Width of boxplot on the axes (data units)</span>
<span class="sd">        bacteria : bool, optional (default is False)</span>
<span class="sd">            If True, uses the geometric mean when `showmean` is True.</span>
<span class="sd">            Otherwise, the arithmetic mean is used.</span>
<span class="sd">        ylabel : string or None (default):</span>
<span class="sd">            Label for y-axis</span>
<span class="sd">        xlims : sequence (length=2), dict, or None (default), optional</span>
<span class="sd">            Custom limits of the x-axis. If None, defaults to</span>
<span class="sd">            [pos-1, pos+1].</span>
<span class="sd">        bothTicks : bool, optional (default is True)</span>
<span class="sd">            If True, each box gets a tick label. Otherwise, both get a</span>
<span class="sd">            single tick.</span>
<span class="sd">        offset : float, optional (default = 0.5)</span>
<span class="sd">            Spacing, in x-axis data coordinates, of the boxplots.</span>
<span class="sd">        patch_artist : bool, optional (default = False)</span>
<span class="sd">            Toggles the use of patch artist instead of a line artists</span>
<span class="sd">            for the boxes</span>
<span class="sd">        minpoints : int, optional (default = 5)</span>
<span class="sd">            The minimum number of data points required to draw a</span>
<span class="sd">            boxplot. If too few points are present, the drawing will</span>
<span class="sd">            fallback to a verticalScatter plot.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig : matplotlib Figure</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">figutils</span><span class="o">.</span><span class="n">_check_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">loc</span><span class="p">,</span> <span class="n">offset</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">influent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">effluent</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">offset</span><span class="p">,</span> <span class="n">offset</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">loc</span><span class="o">.</span><span class="n">include</span><span class="p">:</span>
                <span class="n">loc</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span> <span class="n">notch</span><span class="o">=</span><span class="n">notch</span><span class="p">,</span> <span class="n">showmean</span><span class="o">=</span><span class="n">showmean</span><span class="p">,</span>
                            <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">bacteria</span><span class="o">=</span><span class="n">bacteria</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                            <span class="n">patch_artist</span><span class="o">=</span><span class="n">patch_artist</span><span class="p">,</span> <span class="n">minpoints</span><span class="o">=</span><span class="n">minpoints</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="n">yscale</span><span class="p">)</span>
        <span class="n">label_format</span> <span class="o">=</span> <span class="n">mticker</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">figutils</span><span class="o">.</span><span class="n">alt_logLabelFormatter</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">yscale</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">label_format</span><span class="p">)</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">figutils</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">yminor</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ylabel</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">xlims</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">pos</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xlims</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">**</span><span class="n">xlims</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlims</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bothTicks</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="n">pos</span><span class="o">-</span><span class="n">offset</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="n">offset</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">influent</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">effluent</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="n">pos</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">])</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="Dataset.probplot"><a class="viewcode-back" href="../../api/features.html#wqio.features.Dataset.probplot">[docs]</a>    <span class="k">def</span> <span class="nf">probplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">axtype</span><span class="o">=</span><span class="s1">&#39;prob&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">clearYLabels</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">rotateticklabels</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">setxlimits</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">managegrid</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">bestfit</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Adds probability plots to a matplotlib figure</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ax : matplotlib axes object, optional or None (default).</span>
<span class="sd">            The Axes on which to plot. If None is provided, one will be</span>
<span class="sd">            created.</span>
<span class="sd">        yscale : string , optional(default = &#39;log&#39;)</span>
<span class="sd">            Scale for the y-axis. Use &#39;log&#39; for logarithmic (default) or</span>
<span class="sd">            &#39;linear&#39;.</span>
<span class="sd">        axtype : string, optional (default = &#39;pp&#39;)</span>
<span class="sd">            Type of plot to be created. Options are:</span>
<span class="sd">                - &#39;prob&#39;: probabilty plot</span>
<span class="sd">                - &#39;pp&#39;: percentile plot</span>
<span class="sd">                - &#39;qq&#39;: quantile plot</span>
<span class="sd">        ylabel : string, optional or None (default)</span>
<span class="sd">            Axis label for the plot.</span>
<span class="sd">        clearYLabels : bool, optional (default is False)</span>
<span class="sd">            If True, removed y-*tick* labels from teh Axes.</span>
<span class="sd">        rotateticklabels : bool, optional (default is True)</span>
<span class="sd">            If True, the tick labels of the probability axes will be</span>
<span class="sd">            rotated.</span>
<span class="sd">        setxlimits : bool, optional (default is True)</span>
<span class="sd">            If True and `axtype` == &#39;prob&#39;, tehe axis limits will be</span>
<span class="sd">            automatically set based on the number of points in the plot.</span>
<span class="sd">        managegrid : bool, optional (default is True)</span>
<span class="sd">            If True, typical gridlines will be added to the Axes.</span>
<span class="sd">        bestfit : bool, optional (default is False)</span>
<span class="sd">            Specifies whether a best-fit line should be added to the</span>
<span class="sd">            plot.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig : matplotlib Figure</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">figutils</span><span class="o">.</span><span class="n">_check_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">influent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">effluent</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">loc</span><span class="o">.</span><span class="n">include</span><span class="p">:</span>
                <span class="n">loc</span><span class="o">.</span><span class="n">probplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">clearYLabels</span><span class="o">=</span><span class="n">clearYLabels</span><span class="p">,</span> <span class="n">axtype</span><span class="o">=</span><span class="n">axtype</span><span class="p">,</span>
                             <span class="n">yscale</span><span class="o">=</span><span class="n">yscale</span><span class="p">,</span> <span class="n">managegrid</span><span class="o">=</span><span class="n">managegrid</span><span class="p">,</span> <span class="n">bestfit</span><span class="o">=</span><span class="n">bestfit</span><span class="p">,</span>
                             <span class="n">rotateticklabels</span><span class="o">=</span><span class="n">rotateticklabels</span><span class="p">)</span>

        <span class="n">xlabels</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;pp&#39;</span><span class="p">:</span> <span class="s1">&#39;Theoretical percentiles&#39;</span><span class="p">,</span>
            <span class="s1">&#39;qq&#39;</span><span class="p">:</span> <span class="s1">&#39;Theoretical quantiles&#39;</span><span class="p">,</span>
            <span class="s1">&#39;prob&#39;</span><span class="p">:</span> <span class="s1">&#39;Non-exceedance probability (\%)&#39;</span>
        <span class="p">}</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabels</span><span class="p">[</span><span class="n">axtype</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">rotateticklabels</span><span class="p">:</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">figutils</span><span class="o">.</span><span class="n">rotateTickLabels</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">setxlimits</span> <span class="ow">and</span> <span class="n">axtype</span> <span class="o">==</span> <span class="s1">&#39;prob&#39;</span><span class="p">:</span>
            <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">influent</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">effluent</span><span class="o">.</span><span class="n">N</span><span class="p">])</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">figutils</span><span class="o">.</span><span class="n">setProbLimits</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">managegrid</span><span class="p">:</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">figutils</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">yminor</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="Dataset.statplot"><a class="viewcode-back" href="../../api/features.html#wqio.features.Dataset.statplot">[docs]</a>    <span class="k">def</span> <span class="nf">statplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">notch</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">showmean</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">width</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">bacteria</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">axtype</span><span class="o">=</span><span class="s1">&#39;qq&#39;</span><span class="p">,</span>
                 <span class="n">patch_artist</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a two-axis figure with a boxplot &amp; probability plot.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pos : int, optional (default=1)</span>
<span class="sd">            Location along x-axis where boxplot will be placed.</span>
<span class="sd">        yscale : string, optional [&#39;linear&#39; or &#39;log&#39; (default)]</span>
<span class="sd">            Scale formatting of the y-axis</span>
<span class="sd">        notch : bool, optional (default=True)</span>
<span class="sd">            Toggles drawing of bootstrapped confidence interval around</span>
<span class="sd">            the median.</span>
<span class="sd">        showmean : bool, optional (default=True)</span>
<span class="sd">            Toggles plotting the mean value on the boxplot as a point.</span>
<span class="sd">            See also the `bacteria` kwarg</span>
<span class="sd">        width : float, optional (default=0.8)</span>
<span class="sd">            Width of boxplot on the axes (data units)</span>
<span class="sd">        bacteria : bool, optional (default False)</span>
<span class="sd">            If True, uses the geometric mean when `showmean` is True.</span>
<span class="sd">            Otherwise, the arithmetic mean is used.</span>
<span class="sd">        ylabel : string, optional or None (default):</span>
<span class="sd">            Label for y-axis</span>
<span class="sd">        probAxis : bool, optional (default = True)</span>
<span class="sd">            Toggles the display of probabilities (True) or Z-scores</span>
<span class="sd">            (i.e., theoretical quantiles) on the x-axis</span>
<span class="sd">        patch_artist : bool, optional (default = False)</span>
<span class="sd">            Toggles the use of patch artist instead of a line artists</span>
<span class="sd">            for the boxes</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig : matplotlib Figure</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># setup the figure and axes</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">6.40</span><span class="p">,</span> <span class="mf">3.00</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                         <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
        <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="n">yscale</span><span class="p">,</span> <span class="n">notch</span><span class="o">=</span><span class="n">notch</span><span class="p">,</span>
                     <span class="n">showmean</span><span class="o">=</span><span class="n">showmean</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">bacteria</span><span class="o">=</span><span class="n">bacteria</span><span class="p">,</span>
                     <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">patch_artist</span><span class="o">=</span><span class="n">patch_artist</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">probplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="n">yscale</span><span class="p">,</span> <span class="n">axtype</span><span class="o">=</span><span class="n">axtype</span><span class="p">,</span>
                      <span class="n">ylabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">clearYLabels</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                      <span class="n">rotateticklabels</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">setxlimits</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">ax1</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">tick_left</span><span class="p">()</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">tick_right</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="Dataset.jointplot"><a class="viewcode-back" href="../../api/features.html#wqio.features.Dataset.jointplot">[docs]</a>    <span class="k">def</span> <span class="nf">jointplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hist</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">rug</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">scatter_kws</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create a joint distribution plot for the dataset</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        hist : bool, optional (default is False)</span>
<span class="sd">            Toggles showing histograms on the distribution plots</span>
<span class="sd">        kde : bool, optional (default is True)</span>
<span class="sd">            Toggles showing KDE plots on the distribution plots</span>
<span class="sd">        run : bool, optional (default is True)</span>
<span class="sd">            Toggles showing rug plots on the distribution plots</span>
<span class="sd">        **scatter_kws : keyword arguments</span>
<span class="sd">            Optionals passed directly to Dataset.scatterplot</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        jg : seaborn.JointGrid</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        seaborn.JointGrid</span>
<span class="sd">        seaborn.jointplot</span>
<span class="sd">        seaborn.distplot</span>
<span class="sd">        Dataset.scatterplot</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">showlegend</span> <span class="o">=</span> <span class="n">scatter_kws</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;showlegend&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">scatter_kws</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">paired_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">paired_data</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="s1">&#39;res&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">jg</span> <span class="o">=</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">JointGrid</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;inflow&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;outflow&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">jg</span><span class="o">.</span><span class="n">ax_joint</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">scatter_kws</span><span class="p">)</span>
            <span class="n">jg</span><span class="o">.</span><span class="n">plot_marginals</span><span class="p">(</span><span class="n">seaborn</span><span class="o">.</span><span class="n">distplot</span><span class="p">,</span> <span class="n">hist</span><span class="o">=</span><span class="n">hist</span><span class="p">,</span> <span class="n">rug</span><span class="o">=</span><span class="n">rug</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="n">kde</span><span class="p">)</span>

            <span class="n">jg</span><span class="o">.</span><span class="n">ax_marg_x</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="n">scatter_kws</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;xscale&#39;</span><span class="p">,</span> <span class="s1">&#39;log&#39;</span><span class="p">))</span>
            <span class="n">jg</span><span class="o">.</span><span class="n">ax_marg_y</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="n">scatter_kws</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;yscale&#39;</span><span class="p">,</span> <span class="s1">&#39;log&#39;</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">showlegend</span><span class="p">:</span>
                <span class="n">jg</span><span class="o">.</span><span class="n">ax_joint</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jg</span></div>

<div class="viewcode-block" id="Dataset.scatterplot"><a class="viewcode-back" href="../../api/features.html#wqio.features.Dataset.scatterplot">[docs]</a>    <span class="k">def</span> <span class="nf">scatterplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xscale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                    <span class="n">xlabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">one2one</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">useROS</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                    <span class="n">bestfit</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">minpoints</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">eqn_pos</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span>
                    <span class="n">equal_scales</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates an influent/effluent scatter plot</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ax : matplotlib axes object or None (default), optional</span>
<span class="sd">            Axes on which the scatterplot with be drawn. If None, one</span>
<span class="sd">            will be created.</span>
<span class="sd">        xscale, yscale : string [&#39;linear&#39; or &#39;log&#39; (default)], optional</span>
<span class="sd">            Scale formatting of the [x|y]-axis</span>
<span class="sd">        xlabel, ylabel : string or None (default), optional:</span>
<span class="sd">            Label for [x|y]-axis. If None, will be &#39;Influent&#39;. If the</span>
<span class="sd">            dataset definition is available and incldues a Parameter,</span>
<span class="sd">            that will be included as will. For no label, use</span>
<span class="sd">            e.g., `xlabel = &quot;&quot;`.</span>
<span class="sd">        showlegend : bool, optional (default is True)</span>
<span class="sd">            Toggles including a legend on the plot.</span>
<span class="sd">        one2one : bool, optional (default is False), optional</span>
<span class="sd">            Toggles the inclusion of the 1:1 line (i.e. line of</span>
<span class="sd">            equality).</span>
<span class="sd">        useROS : bool, optional (default is False)</span>
<span class="sd">            Toggles the use of the ROS&#39;d results. If False, raw results</span>
<span class="sd">            (i.e., detection limit for NDs) are used with varying</span>
<span class="sd">            symbology.</span>

<span class="sd">        Returns</span>
<span class="sd">        ------</span>
<span class="sd">        fig : matplotlib Figure</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># set up the figure/axes</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">figutils</span><span class="o">.</span><span class="n">_check_ax</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

        <span class="c1"># set the scales</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="n">xscale</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="n">yscale</span><span class="p">)</span>

        <span class="c1"># common symbology</span>
        <span class="n">markerkwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
            <span class="n">markeredgewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># plot the ROSd&#39;d result, if requested</span>
        <span class="k">if</span> <span class="n">useROS</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">paired_data</span><span class="o">.</span><span class="n">inflow</span><span class="o">.</span><span class="n">res</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">paired_data</span><span class="o">.</span><span class="n">outflow</span><span class="o">.</span><span class="n">res</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Paired, ROS&#39;d data&quot;</span><span class="p">,</span>  <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="o">**</span><span class="n">markerkwargs</span><span class="p">)</span>

        <span class="c1"># plot the raw results, if requested</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plot_nds</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;neither&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Detected data pairs&#39;</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                           <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">markerkwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plot_nds</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;influent&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.45</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Influent not detected&#39;</span><span class="p">,</span>  <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                           <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">markerkwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plot_nds</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;effluent&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.45</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Effluent not detected&#39;</span><span class="p">,</span>  <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                           <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">markerkwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plot_nds</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Both not detected&#39;</span><span class="p">,</span>  <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                           <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">markerkwargs</span><span class="p">)</span>

        <span class="n">label_format</span> <span class="o">=</span> <span class="n">mticker</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">figutils</span><span class="o">.</span><span class="n">alt_logLabelFormatter</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xscale</span> <span class="o">!=</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">yscale</span> <span class="o">!=</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># unify the axes limits</span>
        <span class="k">if</span> <span class="n">xscale</span> <span class="o">==</span> <span class="n">yscale</span> <span class="ow">and</span> <span class="n">equal_scales</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
            <span class="n">axis_limits</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">(),</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()]),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">(),</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()])</span>
            <span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">axis_limits</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">axis_limits</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">yscale</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span> <span class="ow">or</span> <span class="n">xscale</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
            <span class="n">axis_limits</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()),</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">())]),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">(),</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()])</span>
            <span class="p">]</span>

        <span class="c1"># include the line of equality, if requested</span>
        <span class="k">if</span> <span class="n">one2one</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">axis_limits</span><span class="p">,</span> <span class="n">axis_limits</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.25</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.50</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;1:1 line&#39;</span><span class="p">)</span>

        <span class="n">detects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">paired_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paired_data</span><span class="p">[(</span><span class="s1">&#39;inflow&#39;</span><span class="p">,</span> <span class="s1">&#39;qual&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">influent</span><span class="o">.</span><span class="n">ndvals</span><span class="p">))</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paired_data</span><span class="p">[(</span><span class="s1">&#39;outflow&#39;</span><span class="p">,</span> <span class="s1">&#39;qual&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">effluent</span><span class="o">.</span><span class="n">ndvals</span><span class="p">))</span>
        <span class="p">]</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="s1">&#39;res&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bestfit</span> <span class="ow">and</span> <span class="n">detects</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">minpoints</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">xscale</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span> <span class="ow">and</span> <span class="n">yscale</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
                <span class="n">fitlogs</span> <span class="o">=</span> <span class="s1">&#39;both&#39;</span>
            <span class="k">elif</span> <span class="n">xscale</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
                <span class="n">fitlogs</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>
            <span class="k">elif</span> <span class="n">yscale</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
                <span class="n">fitlogs</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fitlogs</span> <span class="o">=</span> <span class="bp">None</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">detects</span><span class="p">[</span><span class="s1">&#39;inflow&#39;</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">detects</span><span class="p">[</span><span class="s1">&#39;outflow&#39;</span><span class="p">]</span>

            <span class="n">xhat</span><span class="p">,</span> <span class="n">yhat</span><span class="p">,</span> <span class="n">modelres</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">fit_line</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">fitlogs</span><span class="o">=</span><span class="n">fitlogs</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xhat</span><span class="p">,</span> <span class="n">yhat</span><span class="p">,</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Best-fit&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">eqn_pos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">positions</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;lower left&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">),</span>
                    <span class="s1">&#39;lower right&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.59</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">),</span>
                    <span class="s1">&#39;upper left&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">),</span>
                    <span class="s1">&#39;upper right&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.59</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="n">vert_offset</span> <span class="o">=</span> <span class="mf">0.05</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">txt_x</span><span class="p">,</span> <span class="n">txt_y</span> <span class="o">=</span> <span class="n">positions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">eqn_pos</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`eqn_pos` must be on of &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">list</span><span class="o">.</span><span class="n">positions</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                <span class="c1"># annotate axes with stats</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
                    <span class="s1">r&#39;$\log(y) = m \, \log(x) + b$&#39;</span><span class="p">,</span>
                    <span class="p">(</span><span class="n">txt_x</span><span class="p">,</span> <span class="n">txt_y</span><span class="p">),</span>
                    <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span>
                <span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
                    <span class="s1">r&#39;Slope, $ m = </span><span class="si">%0.3f</span><span class="s1"> $&#39;</span> <span class="o">%</span> <span class="n">modelres</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;inflow&#39;</span><span class="p">],</span>
                    <span class="p">(</span><span class="n">txt_x</span><span class="p">,</span> <span class="n">txt_y</span> <span class="o">-</span> <span class="n">vert_offset</span><span class="p">),</span>
                    <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span>
                <span class="p">)</span>
                <span class="c1">#ax.annotate(r&#39;P-value, $ p = %s $&#39; % fmt_p, (0.59, 0.05), xycoords=&#39;axes fraction&#39;)</span>


        <span class="c1"># setup the axes labels</span>
        <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;Influent&#39;</span>

        <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;Effluent&#39;</span>

        <span class="c1"># create major/minor gridlines and apply the axes labels</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">figutils</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>

        <span class="c1"># show legend, if requested</span>
        <span class="k">if</span> <span class="n">showlegend</span><span class="p">:</span>
            <span class="n">leg</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.00</span><span class="p">)</span>
            <span class="n">leg</span><span class="o">.</span><span class="n">get_frame</span><span class="p">()</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mf">0.00</span><span class="p">)</span>
            <span class="n">leg</span><span class="o">.</span><span class="n">get_frame</span><span class="p">()</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">fig</span></div>

    <span class="k">def</span> <span class="nf">_plot_nds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;_no_legend&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">markerkwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Helper function for scatter plots -- plots various combinations</span>
<span class="sd">        of non-detect paired data</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># store the original useROS value</span>
        <span class="n">use_ros_cache</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">useROS</span>


        <span class="k">if</span> <span class="n">which</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paired_data</span><span class="p">[(</span><span class="s1">&#39;inflow&#39;</span><span class="p">,</span> <span class="s1">&#39;qual&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">influent</span><span class="o">.</span><span class="n">ndvals</span><span class="p">))</span> <span class="o">&amp;</span> \
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paired_data</span><span class="p">[(</span><span class="s1">&#39;outflow&#39;</span><span class="p">,</span> <span class="s1">&#39;qual&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">effluent</span><span class="o">.</span><span class="n">ndvals</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">which</span> <span class="o">==</span> <span class="s1">&#39;influent&#39;</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paired_data</span><span class="p">[(</span><span class="s1">&#39;inflow&#39;</span><span class="p">,</span> <span class="s1">&#39;qual&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">influent</span><span class="o">.</span><span class="n">ndvals</span><span class="p">))</span> <span class="o">&amp;</span> \
                    <span class="p">(</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">paired_data</span><span class="p">[(</span><span class="s1">&#39;outflow&#39;</span><span class="p">,</span> <span class="s1">&#39;qual&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">effluent</span><span class="o">.</span><span class="n">ndvals</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">which</span> <span class="o">==</span> <span class="s1">&#39;effluent&#39;</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">paired_data</span><span class="p">[(</span><span class="s1">&#39;inflow&#39;</span><span class="p">,</span> <span class="s1">&#39;qual&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">influent</span><span class="o">.</span><span class="n">ndvals</span><span class="p">))</span> <span class="o">&amp;</span> \
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paired_data</span><span class="p">[(</span><span class="s1">&#39;outflow&#39;</span><span class="p">,</span> <span class="s1">&#39;qual&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">effluent</span><span class="o">.</span><span class="n">ndvals</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">which</span> <span class="o">==</span> <span class="s1">&#39;neither&#39;</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">paired_data</span><span class="p">[(</span><span class="s1">&#39;inflow&#39;</span><span class="p">,</span> <span class="s1">&#39;qual&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">influent</span><span class="o">.</span><span class="n">ndvals</span><span class="p">))</span> <span class="o">&amp;</span> \
                    <span class="p">(</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">paired_data</span><span class="p">[(</span><span class="s1">&#39;outflow&#39;</span><span class="p">,</span> <span class="s1">&#39;qual&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">effluent</span><span class="o">.</span><span class="n">ndvals</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;`which` must be &quot;both&quot;, &quot;influent&quot;, &#39;</span> \
                  <span class="s1">&#39;&quot;effluent&quot;, or &quot;neighter&quot;&#39;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">paired_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][(</span><span class="s1">&#39;inflow&#39;</span><span class="p">,</span> <span class="s1">&#39;res&#39;</span><span class="p">)]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">paired_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][(</span><span class="s1">&#39;outflow&#39;</span><span class="p">,</span> <span class="s1">&#39;res&#39;</span><span class="p">)]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="o">**</span><span class="n">markerkwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataCollection"><a class="viewcode-back" href="../../api/features.html#wqio.features.DataCollection">[docs]</a><span class="k">class</span> <span class="nc">DataCollection</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; WIP: object to compare an arbitrary number of Locations</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dataframe : pandas.DataFrame</span>
<span class="sd">        Dataframe all of the data to analyze.</span>
<span class="sd">    rescol, qualcol, stationcol, paramcol : string</span>
<span class="sd">        Column labels for the results, qualifiers, stations (monitoring</span>
<span class="sd">        locations), and parameters (pollutants), respectively.</span>
<span class="sd">    ndval : string (default = &#39;ND&#39;)</span>
<span class="sd">        The *only* value found in ``qualcol`` that indicates that a</span>
<span class="sd">        result is a non-detect. Non-detect results should be reported</span>
<span class="sd">        as the detection limits.</span>
<span class="sd">    othergroups : list of strings, optional</span>
<span class="sd">        Other columns besides ``stationcol`` and ``paramcol`` that</span>
<span class="sd">        should be considered when grouping into subsets of data.</span>
<span class="sd">    useROS : bool (default = True)</span>
<span class="sd">        Toggles the use of Regression On Order Statistics to</span>
<span class="sd">        estimate non-detect values when computing statistics.</span>
<span class="sd">    filterfxn : callable, optional</span>
<span class="sd">        Function that will we passes to a pandas.Groupby object that</span>
<span class="sd">        will filter out groups that should not be analyzed (for</span>
<span class="sd">        whatever reason).</span>
<span class="sd">    bsIter : int</span>
<span class="sd">        Number of iterations the bootstrapper should use when estimating</span>
<span class="sd">        confidence intervals around a statistic.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataframe</span><span class="p">,</span> <span class="n">rescol</span><span class="o">=</span><span class="s1">&#39;res&#39;</span><span class="p">,</span> <span class="n">qualcol</span><span class="o">=</span><span class="s1">&#39;qual&#39;</span><span class="p">,</span> <span class="n">cencol</span><span class="o">=</span><span class="s1">&#39;cen&#39;</span><span class="p">,</span>
                 <span class="n">stationcol</span><span class="o">=</span><span class="s1">&#39;station&#39;</span><span class="p">,</span> <span class="n">paramcol</span><span class="o">=</span><span class="s1">&#39;parameter&#39;</span><span class="p">,</span> <span class="n">ndval</span><span class="o">=</span><span class="s1">&#39;ND&#39;</span><span class="p">,</span>
                 <span class="n">othergroups</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">useROS</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">filterfxn</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">bsIter</span><span class="o">=</span><span class="mi">10000</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_filterfxn</span> <span class="o">=</span> <span class="n">filterfxn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raw_rescol</span> <span class="o">=</span> <span class="n">rescol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span> <span class="o">=</span> <span class="n">resettable_cache</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">useROS</span> <span class="o">=</span> <span class="n">useROS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">roscol</span> <span class="o">=</span> <span class="s1">&#39;ros_&#39;</span> <span class="o">+</span> <span class="n">rescol</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">useROS</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rescol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">roscol</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rescol</span> <span class="o">=</span> <span class="n">rescol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qualcol</span> <span class="o">=</span> <span class="n">qualcol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stationcol</span> <span class="o">=</span> <span class="n">stationcol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">paramcol</span> <span class="o">=</span> <span class="n">paramcol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cencol</span> <span class="o">=</span> <span class="n">cencol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndval</span> <span class="o">=</span> <span class="p">[</span><span class="n">ndval</span><span class="p">]</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">ndval</span><span class="p">)</span> <span class="k">else</span> <span class="n">ndval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bsIter</span> <span class="o">=</span> <span class="n">bsIter</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">groupcols</span> <span class="o">=</span> <span class="p">[</span><span class="n">stationcol</span><span class="p">,</span> <span class="n">paramcol</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">othergroups</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">othergroups</span><span class="p">):</span>
                <span class="n">othergroups</span> <span class="o">=</span> <span class="p">[</span><span class="n">othergroups</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">groupcols</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">othergroups</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupcols</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw_rescol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cencol</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">cencol</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">qualcol</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndval</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">filterfxn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filterfxn</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filterfxn</span>
    <span class="nd">@filterfxn.setter</span>
    <span class="k">def</span> <span class="nf">filterfxn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filterfxn</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="DataCollection.tidy"><a class="viewcode-back" href="../../api/features.html#wqio.features.DataCollection.tidy">[docs]</a>    <span class="k">def</span> <span class="nf">tidy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">useROS</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">fxn</span><span class="p">(</span><span class="n">g</span><span class="p">):</span>
                <span class="n">rosdf</span> <span class="o">=</span> <span class="n">ROS</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">g</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw_rescol</span><span class="p">,</span>
                                      <span class="n">censorship</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cencol</span><span class="p">,</span> <span class="n">as_array</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                <span class="n">rosdf</span> <span class="o">=</span> <span class="n">rosdf</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;final&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">roscol</span><span class="p">})</span>
                <span class="k">return</span> <span class="n">rosdf</span><span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw_rescol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">roscol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cencol</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">fxn</span><span class="p">(</span><span class="n">g</span><span class="p">):</span>
                <span class="n">g</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">roscol</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="k">return</span> <span class="n">g</span>

        <span class="n">keep_cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">roscol</span><span class="p">]</span>
        <span class="n">_tidy</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
                <span class="o">.</span><span class="n">reset_index</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
                <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">groupcols</span><span class="p">)</span>
                <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filterfxn</span><span class="p">)</span>
                <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">groupcols</span><span class="p">)</span>
                <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">fxn</span><span class="p">)</span>
                <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
                <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">groupcols</span><span class="p">)</span>
        <span class="p">)[</span><span class="n">keep_cols</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">_tidy</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="DataCollection.locations"><a class="viewcode-back" href="../../api/features.html#wqio.features.DataCollection.locations">[docs]</a>    <span class="k">def</span> <span class="nf">locations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_locations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
                <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">groupcols</span><span class="p">)</span>
                <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filterfxn</span><span class="p">)</span>
                <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">groupcols</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">names</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
            <span class="n">loc_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groupcols</span><span class="p">,</span> <span class="n">names</span><span class="p">))</span>
            <span class="n">locdata</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">locdata</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">locdata</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationcol</span><span class="p">)</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">Location</span><span class="p">(</span>
                <span class="n">locdata</span><span class="p">,</span> <span class="n">station_type</span><span class="o">=</span><span class="n">loc_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stationcol</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
                <span class="n">rescol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw_rescol</span><span class="p">,</span> <span class="n">qualcol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qualcol</span><span class="p">,</span>
                <span class="n">ndval</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ndval</span><span class="p">,</span> <span class="n">bsIter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bsIter</span><span class="p">,</span> <span class="n">useROS</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">useROS</span>
            <span class="p">)</span>

            <span class="n">loc</span><span class="o">.</span><span class="n">definition</span> <span class="o">=</span> <span class="n">loc_dict</span>
            <span class="n">_locations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_locations</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="DataCollection.datasets"><a class="viewcode-back" href="../../api/features.html#wqio.features.DataCollection.datasets">[docs]</a>    <span class="k">def</span> <span class="nf">datasets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_datasets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">groupcols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">g</span><span class="p">:</span> <span class="n">g</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stationcol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupcols</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">names</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">groupcols</span><span class="p">):</span>
            <span class="n">ds_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">groupcols</span><span class="p">,</span> <span class="n">names</span><span class="p">))</span>

            <span class="n">ds_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stationcol</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;inflow&#39;</span>
            <span class="n">infl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectLocations</span><span class="p">(</span><span class="n">squeeze</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">ds_dict</span><span class="p">)</span>

            <span class="n">ds_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stationcol</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;outflow&#39;</span>
            <span class="n">effl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectLocations</span><span class="p">(</span><span class="n">squeeze</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">ds_dict</span><span class="p">)</span>

            <span class="n">ds_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stationcol</span><span class="p">)</span>
            <span class="n">dsname</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">names</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="n">ds</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">infl</span><span class="p">,</span> <span class="n">effl</span><span class="p">,</span> <span class="n">useROS</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">useROS</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">dsname</span><span class="p">)</span>
            <span class="n">ds</span><span class="o">.</span><span class="n">definition</span> <span class="o">=</span> <span class="n">ds_dict</span>

            <span class="n">_datasets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_datasets</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="DataCollection.medians"><a class="viewcode-back" href="../../api/features.html#wqio.features.DataCollection.medians">[docs]</a>    <span class="k">def</span> <span class="nf">medians</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_stat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">,</span> <span class="n">statname</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">)</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="DataCollection.means"><a class="viewcode-back" href="../../api/features.html#wqio.features.DataCollection.means">[docs]</a>    <span class="k">def</span> <span class="nf">means</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_stat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">statname</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="DataCollection.std_devs"><a class="viewcode-back" href="../../api/features.html#wqio.features.DataCollection.std_devs">[docs]</a>    <span class="k">def</span> <span class="nf">std_devs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_stat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">,</span> <span class="n">statname</span><span class="o">=</span><span class="s1">&#39;std. dev.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DataCollection.percentiles"><a class="viewcode-back" href="../../api/features.html#wqio.features.DataCollection.percentiles">[docs]</a>    <span class="k">def</span> <span class="nf">percentiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">percentile</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_stat</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">percentile</span><span class="p">),</span>
                                  <span class="n">statname</span><span class="o">=</span><span class="s1">&#39;pctl {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">percentile</span><span class="p">),</span>
                                  <span class="n">use_bootstrap</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="DataCollection.logmean"><a class="viewcode-back" href="../../api/features.html#wqio.features.DataCollection.logmean">[docs]</a>    <span class="k">def</span> <span class="nf">logmean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_stat</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">),</span> <span class="n">statname</span><span class="o">=</span><span class="s1">&#39;Log-mean&#39;</span><span class="p">)</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="DataCollection.logstd"><a class="viewcode-back" href="../../api/features.html#wqio.features.DataCollection.logstd">[docs]</a>    <span class="k">def</span> <span class="nf">logstd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_stat</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">),</span> <span class="n">statname</span><span class="o">=</span><span class="s1">&#39;Log-std. dev.&#39;</span><span class="p">)</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="DataCollection.geomean"><a class="viewcode-back" href="../../api/features.html#wqio.features.DataCollection.geomean">[docs]</a>    <span class="k">def</span> <span class="nf">geomean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">geomean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logmean</span><span class="p">)</span>
        <span class="n">geomean</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">,</span> <span class="s1">&#39;Geo-mean&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">geomean</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="DataCollection.geostd"><a class="viewcode-back" href="../../api/features.html#wqio.features.DataCollection.geostd">[docs]</a>    <span class="k">def</span> <span class="nf">geostd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">geostd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logstd</span><span class="p">)</span>
        <span class="n">geostd</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">,</span> <span class="s1">&#39;Geo-std. dev.&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">geostd</span></div>

    <span class="nd">@cache_readonly</span>
<div class="viewcode-block" id="DataCollection.count"><a class="viewcode-back" href="../../api/features.html#wqio.features.DataCollection.count">[docs]</a>    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_stat</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="n">use_bootstrap</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">statname</span><span class="o">=</span><span class="s1">&#39;Count&#39;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_generic_stat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statfxn</span><span class="p">,</span> <span class="n">use_bootstrap</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">statname</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">CIs</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="n">stat</span><span class="p">,</span> <span class="p">(</span><span class="n">lci</span><span class="p">,</span> <span class="n">uci</span><span class="p">)</span> <span class="o">=</span> <span class="n">bootstrap</span><span class="o">.</span><span class="n">BCA</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rescol</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">statfxn</span><span class="o">=</span><span class="n">statfxn</span><span class="p">)</span>
            <span class="n">statnames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="s1">&#39;stat&#39;</span><span class="p">,</span> <span class="s1">&#39;upper&#39;</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">lci</span><span class="p">,</span> <span class="n">stat</span><span class="p">,</span> <span class="n">uci</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">statnames</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">use_bootstrap</span><span class="p">:</span>
            <span class="n">stat</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tidy</span>
                    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">groupcols</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">CIs</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationcol</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stat</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tidy</span>
                    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">groupcols</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="bp">self</span><span class="o">.</span><span class="n">rescol</span><span class="p">:</span> <span class="n">statfxn</span><span class="p">})</span>
                    <span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stationcol</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="n">stat</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">stat</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">swaplevel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">statname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">stat</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">,</span> <span class="n">statname</span><span class="p">]</span>
        <span class="n">stat</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">stat</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_filter_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">squeeze</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">definition</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span><span class="p">,</span> <span class="n">items</span><span class="p">)]</span>

        <span class="k">if</span> <span class="n">squeeze</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">items</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">items</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">return</span> <span class="n">items</span>

<div class="viewcode-block" id="DataCollection.selectLocations"><a class="viewcode-back" href="../../api/features.html#wqio.features.DataCollection.selectLocations">[docs]</a>    <span class="k">def</span> <span class="nf">selectLocations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">locations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_collection</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">locations</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">squeeze</span><span class="o">=</span><span class="n">squeeze</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">locations</span></div>

<div class="viewcode-block" id="DataCollection.selectDatasets"><a class="viewcode-back" href="../../api/features.html#wqio.features.DataCollection.selectDatasets">[docs]</a>    <span class="k">def</span> <span class="nf">selectDatasets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">datasets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_collection</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">squeeze</span><span class="o">=</span><span class="n">squeeze</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">datasets</span></div>

<div class="viewcode-block" id="DataCollection.stat_summary"><a class="viewcode-back" href="../../api/features.html#wqio.features.DataCollection.stat_summary">[docs]</a>    <span class="k">def</span> <span class="nf">stat_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groupcols</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">useROS</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">useROS</span><span class="p">:</span>
            <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">roscol</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rescol</span>

        <span class="k">if</span> <span class="n">groupcols</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">groupcols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupcols</span>

        <span class="n">ptiles</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">]</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tidy</span>
                <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">groupcols</span><span class="p">)</span>
                <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">g</span><span class="p">:</span> <span class="n">g</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">percentiles</span><span class="o">=</span><span class="n">ptiles</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
                <span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;station&#39;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">summary</span></div>

<div class="viewcode-block" id="DataCollection.facet_kde"><a class="viewcode-back" href="../../api/features.html#wqio.features.DataCollection.facet_kde">[docs]</a>    <span class="k">def</span> <span class="nf">facet_kde</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="s1">&#39;category&#39;</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s1">&#39;parameter&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;station&#39;</span><span class="p">,</span>
                  <span class="n">log</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tidy</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
            <span class="n">plotcol</span> <span class="o">=</span> <span class="s1">&#39;Log of {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rescol</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">))</span>
            <span class="n">df</span><span class="p">[</span><span class="n">plotcol</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rescol</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pltcol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rescol</span>

        <span class="n">fgrid</span> <span class="o">=</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">FacetGrid</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="n">hue</span><span class="p">,</span>
                                  <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                  <span class="n">margin_titles</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                  <span class="n">legend_out</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">fgrid</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">seaborn</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">,</span> <span class="n">plotcol</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fgrid</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Paul Hobson (Geosyntec Consultants).

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.4.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>